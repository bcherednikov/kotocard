# –ü–ª–∞–Ω –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º—É TTS (Web Speech API)

## –ü—Ä–æ–±–ª–µ–º–∞
Piper TTS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ (3-10 —Å–µ–∫), –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –í—Ä–µ–º–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º—É TTS (speechSynthesis).

---

## –ß—Ç–æ –º–µ–Ω—è—Ç—å

### üìÅ –§—Ä–æ–Ω—Ç–µ–Ω–¥ (9 —Ñ–∞–π–ª–æ–≤)

#### 1. `src/lib/tts/playTts.ts` ‚ö†Ô∏è –û–°–ù–û–í–ù–û–ô –§–ê–ô–õ
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ–π—á–∞—Å:**
- `playTtsForCard(cardId, lang)` ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/api/tts/card/[id]`
- `playTts(text, lang)` ‚Üí –∑–∞–ø—Ä–æ—Å –∫ `/api/tts`

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `playTextBrowser(text, lang)` —Å Web Speech API
- –£–±—Ä–∞—Ç—å –≤—Å–µ fetch-–∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É

#### 2-4. –°—Ç—Ä–∞–Ω–∏—Ü—ã review (3 —Ñ–∞–π–ª–∞)
- `src/app/student/decks/[id]/study/page.tsx`
- `src/app/student/decks/[id]/review/page.tsx`
- `src/app/student/review/page.tsx`

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç:** –≤—ã–∑—ã–≤–∞—é—Ç `speakCard(card.card_id, 'en')`  
**–ß—Ç–æ –Ω—É–∂–Ω–æ:** –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `speakText(card.en_text, 'en')`

#### 5. –°—Ç—Ä–∞–Ω–∏—Ü–∞ test
- `src/app/student/decks/[id]/test/page.tsx`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–µ—Ä–µ–¥–∞—ë—Ç `speakCard` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤  
**–ß—Ç–æ –Ω—É–∂–Ω–æ:** –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `speakText` –≤–º–µ—Å—Ç–æ `speakCard`

#### 6-8. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ (3 —Ñ–∞–π–ª–∞)
- `src/components/student/test/AudioQuestion.tsx`
- `src/components/student/test/ChoiceQuestion.tsx`
- `src/components/student/test/DictationQuestion.tsx`

**–ß—Ç–æ –¥–µ–ª–∞—é—Ç:** –ø—Ä–∏–Ω–∏–º–∞—é—Ç `speakCard(cardId, lang)` –∏ –≤—ã–∑—ã–≤–∞—é—Ç –ø–æ `cardId`  
**–ß—Ç–æ –Ω—É–∂–Ω–æ:** –ø—Ä–∏–Ω–∏–º–∞—Ç—å `speakText(text, lang)` –∏ –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ —Ç–µ–∫—Å—Ç—É

#### 9. –≠–∫—Å–ø–æ—Ä—Ç—ã
- `src/lib/tts/index.ts`

**–ß—Ç–æ –Ω—É–∂–Ω–æ:** —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS

---

### üîß –ë—ç–∫–µ–Ω–¥ (–ù–ï –¢–†–û–ì–ê–¢–¨ - –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å)

**–§–∞–π–ª—ã:**
- `src/app/api/tts/route.ts` ‚Äî legacy Piper endpoint
- `src/app/api/tts/card/[id]/route.ts` ‚Äî –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ TTS
- `src/app/api/cards/[id]/generate-tts/route.ts` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
- `src/app/api/decks/[id]/generate-tts/route.ts` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –Ω–∞–±–æ—Ä–∞
- `src/app/api/bulk-create-cards/route.ts` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `src/lib/tts/tts-server.ts` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- `src/lib/tts/generate-background.ts` ‚Äî —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–ü–æ—á–µ–º—É –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å:**
- ‚úÖ –û–Ω–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –µ—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ idle
- ‚úÖ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –≤–µ—Ä–Ω—É—Ç—å –ø–æ–∑–∂–µ, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∏–≤ —Ñ—Ä–æ–Ω—Ç
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ" –≤ –∞–¥–º–∏–Ω–∫–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è (–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∑–∞—Ä–∞–Ω–µ–µ)

---

## –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø–æ—Ä—è–¥–æ–∫)

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS
–§–∞–π–ª: `src/lib/tts/playTts.ts`
- –î–æ–±–∞–≤–∏—Ç—å `playTextBrowser(text, lang)` —Å Web Speech API
- –û—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã
–§–∞–π–ª: `src/lib/tts/index.ts`
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `playTextBrowser` –∫–∞–∫ `playTts`

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã review (3 —Ñ–∞–π–ª–∞)
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `speakCard` ‚Üí `speakText`
- –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤: `speakCard(card.card_id, 'en')` ‚Üí `speakText(card.en_text, 'en')`

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É test
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `speakCard` ‚Üí `speakText`
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `speakText` –≤–º–µ—Å—Ç–æ `speakCard`

### –®–∞–≥ 5: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ (3 —Ñ–∞–π–ª–∞)
- –ò–∑–º–µ–Ω–∏—Ç—å props: `speakCard: (cardId, lang)` ‚Üí `speakText: (text, lang)`
- –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤—ã: `speakCard(question.targetCard.id, 'en')` ‚Üí `speakText(question.audioText, 'en')`

### –®–∞–≥ 6: –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ TTS —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Ä–µ–∂–∏–º–∞—Ö

### –®–∞–≥ 7: –î–µ–ø–ª–æ–π
- –ö–æ–º–º–∏—Ç + push + deploy

---

## –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–§—Ä–æ–Ω—Ç–µ–Ω–¥:** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)  
‚úÖ **–ë—ç–∫–µ–Ω–¥:** Piper API –æ—Å—Ç–∞—é—Ç—Å—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ –≥–æ—Ç–æ–≤—ã)  
‚úÖ **–ê–¥–º–∏–Ω–∫–∞:** –∫–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)  
‚úÖ **–°–µ—Ä–≤–∏—Å:** –Ω–µ —Ç–æ—Ä–º–æ–∑–∏—Ç, —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ  

---

## –û—Ü–µ–Ω–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|------|-----------|-----------|
| `src/lib/tts/playTts.ts` | –î–æ–±–∞–≤–∏—Ç—å Web Speech API | ‚≠ê‚≠ê |
| `src/lib/tts/index.ts` | –ò–∑–º–µ–Ω–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã | ‚≠ê |
| 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã review | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é + –≤—ã–∑–æ–≤—ã | ‚≠ê |
| 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ test | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å + –ø–µ—Ä–µ–¥–∞—á–∞ props | ‚≠ê |
| 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ | –ò–∑–º–µ–Ω–∏—Ç—å props + –≤—ã–∑–æ–≤—ã | ‚≠ê‚≠ê |

**–í—Å–µ–≥–æ:** 9 —Ñ–∞–π–ª–æ–≤, ~30-40 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

## Web Speech API (—Å–ø—Ä–∞–≤–∫–∞)

```typescript
function playTextBrowser(text: string, lang: 'en' | 'ru') {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang === 'ru' ? 'ru-RU' : 'en-US';
  utterance.rate = 0.9; // —Å–∫–æ—Ä–æ—Å—Ç—å
  speechSynthesis.speak(utterance);
}
```

**–ü–ª—é—Å—ã:**
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ (–Ω–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (–≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä)
- üé≠ –ú–Ω–æ–≥–æ –≥–æ–ª–æ—Å–æ–≤ (—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ú–∏–Ω—É—Å—ã:**
- üé® –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°/–±—Ä–∞—É–∑–µ—Ä–∞
- üîá –ú–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å —Ä—É—Å—Å–∫–∏—Ö –≥–æ–ª–æ—Å–æ–≤ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
